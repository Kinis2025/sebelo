<!DOCTYPE html>
<html lang="lv">
<head>
    <meta charset="UTF-8">
    <title>Sensoru dati</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            padding: 6px;
            border: 1px solid black;
            text-align: center;
        }
        .alert {
            background-color: #ffcccc;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Sensoru dati</h1>
    <table>
        <thead>
            <tr>
                <th>Sensor ID</th>
                <th>Laiks</th>
                <th>G훮ze 1</th>
                <th>G훮ze 2</th>
                <th>Temperat큰ra (째C)</th>
                <th>Mitrums (%)</th>
                <th>Spiediens (hPa)</th>
                <th>Superkapa (mV)</th>
            </tr>
        </thead>
        <tbody id="sensorTable"></tbody>
    </table>

    <script>
        async function loadSensors() {
            const res = await fetch('/api/sensors');
            const sensors = await res.json();
            const tbody = document.getElementById('sensorTable');
            tbody.innerHTML = '';

            Object.entries(sensors).forEach(([id, data]) => {
                const row = document.createElement('tr');

                let gas1 = data.gas1 ?? data.gas1Prob ?? '-';
                let gas2 = data.gas2 ?? data.gas2Prob ?? '-';
                let gas1Class = (+gas1 > 80) ? 'alert' : '';
                let gas2Class = (+gas2 > 80) ? 'alert' : '';

                row.innerHTML =
                    '<td>' + id + '</td>' +
                    '<td>' + (data.time || '') + '</td>' +
                    '<td class="' + gas1Class + '">' + gas1 + '</td>' +
                    '<td class="' + gas2Class + '">' + gas2 + '</td>' +
                    '<td>' + (data.temperature ?? '-') + '</td>' +
                    '<td>' + (data.humidity ?? '-') + '</td>' +
                    '<td>' + (data.pressure ?? '-') + '</td>' +
                    '<td>' + (data.superCapVoltage ?? '-') + '</td>';

                tbody.appendChild(row);
            });
        }

        setInterval(loadSensors, 5000);
        loadSensors();
    </script>
</body>
</html>
